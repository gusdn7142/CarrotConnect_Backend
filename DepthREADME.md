
# 뎁스의 개발일지

## 2022-01-08 진행상황
#### 1. 프로젝트 기획서 작성 
    - 개발 범위, 개발 우선순위,개발할 기능 및 화면 캡쳐, 1주차까지 작업해올 범위, 서버 개발자 역할 분담, 개발 중 변동사항 및 특이사항 
    
#### 2. 멘토님 피드백 결과 기획서에 반영    
    - 도메인별 API 리스트업 (API 개수 총 33개)
    - 소셜 로그인 API 추가
    - API 10개 추가 (API 개수 총 45개)
    
#### 3. 협업 방법 논의    
    - API 개발 순서 : 1. local 서버에서 API 테스트, 2. github(개인 브랜치)에 push 3. prod 서버에서 API 테스트 및 배포, 4. API 명세서 최신화, 5. main 브랜치에 merge,    
    - 2명이서 개발 일지(README.md) 작성시 충돌 가능 문제 해결 : .md 파일 2개 생성
    
## 2022-01-09 진행상황
#### 1. EC2 인스턴스 생성 (Ubuntu 버전 : 20.04 LTS) 
#### 2. NGINX 서버 구축
#### 3. 도메인 & HTTPS 적용 (https://www.carrot-market.site) 
#### 4. 서브 도메인 (https://dev.carrot-market.site, https://prod.carrot-market.site) 추가
#### 5. RDS 인스턴스 생성 (Mysql 버전 : 8.0.26)
#### 6. Spring boot 개발환경 구축 - 80% 진행 
    - Spring boot와 RDS 연동
    - Spring boot 최초 빌드 및 실행 
    - postman을 통해 Spring boot(9000번 포트) 통신 성공
    - NGINX 리버스 프록시 설정   
    - prod 서버와 dev 서버 구축 (진행 중)
      =>총 2개의 URL과 프로젝트 폴더를 구성해야 한다는 개발 리더(리야)님 피드백 반영
      =>프로젝트 폴더와 URL을 매칭시키는 과정에서 이슈가 발생하여 해결 중
#### 7. ERD 설계 - 10% 진행
    - Aquery tool로 진행
    - 도메인 파악 중
#### 8. 1차 위클리 스크럼 진행 
    - 맥스(클라이언트 개발자) 진행상황 파악
      =>홈 화면 구현 완료, 로그인 화면과 상품 디테일 화면 구현 중
      =>이슈 논의 : 로그인 화면 구현 중에 현재 위치에 따라 주소를 가져오는 문제 
    - 1개의 EC2와 RDS로 협업하기 위해 Yerena에게 공유해야할 사항 논의 (EC2와 RDS의 SSH 연결 정보)
    - Yerena와 DB 설계 방식 조율
      =>Aquery tool로 ERD를 공유하여 협업
      
## 2022-01-10 진행상황
#### 1. 1차 피드백 완료
    - ERD 관련 주요 피드백
      =>한 테이블에서 2개의 외래키가 다른 테이블의 기본키를 동시에 참조 가능  
      =>사진(이미지)은 EC2에 폴더를 만들어 저장하고, 사진 경로만 DB에 저장 
    - API 개발 관련 주요 피드백
      =>현재 위치에 따라 위도,경도를 불러오는 방법 2가지 논의 (클라이언트 혹은 서버가 해결 필요)
      =>응답코드 관련 파일 (ex, BaseResponse.java)을 동시에 작업할 경우 협업시 충돌이 발생할 수 있기 때문에 한 명이 전담
#### 2. Spring boot 개발환경 구축 완료  
    - test API 실행 성공 
    - .gitignore 파일에서 aplication.yml 파일을 제외했는데 build 폴더에서 보이는 문제 해결 필요.
#### 3. ERD 설계 완료 
    - Aquery tool로 ERD를 공유하여 협업
    - 테이블명, 칼럼명 통일
    - 외래키 관계 표현
#### 4. API 명세서에 API 리스트업 (총 58개 반영)
#### 5. API 리스트업에 따라 기획서에 변동 사항 반영


## 2022-01-11 진행상황
#### 1. 회원가입과 로그인 API 개발 - 90% 진행 
    - 이슈 발생
      =>외부 SMS 문자 인증 API를 사용해야 하기 때문에 이 부분은 추후 시간이 남으면 변경 예정
      =>클라이언트가 구현한 화면에 맞게 API를 개발하려면 총 3개의 API가 필요 (회원가입 API, 로그인 API, 회원가입 인증 API (인증코드 재부여))
      =>개발 리더(리야)님 피드백 결과 : 당근마켓 서비스에서 중요한 부분은 중고거래이기 때문에 클라이언트와 잘 협의하여 진행
    - 회원가입 API, 로그인 API, 회원가입 인증 API를 개발을 거의 완료하였고, 세부적인 Validation 처리만 남음.
    - User 테이블과 Region 테이블에 더미데이터를 계속 생성하여 API 테스트 진행 중


## 2022-01-12 진행상황
#### 1. 회원가입 API, 로그인 API, 회원가입 인증 API 개발 완료
    - API 테스트 완료
      =>로컬에서 API 테스트 완료
      =>prod 서버에서 API 테스트 완료
    - 명세서에 반영 완료
   
#### 2. 로그아웃 API, 프로필 조회 API, 프로필 수정 API 개발 - 90% 진행
    - 로컬에서 API 테스트 완료
    
    
## 2022-01-13 진행상황
#### 1. 로그아웃 API, 프로필 조회 API, 프로필 수정 API 개발 완료
    - API 테스트 완료
      =>로컬에서 API 테스트 완료
      =>prod 서버에서 API 테스트 완료
    - 명세서에 반영 완료

#### 2. 명세서 변경
    - 자동 로그아웃 API, 사용자 차단 해제 API 추가 (기획서에도 추가 예정)   
 
#### 3. 자동 로그인 API, 자동 로그아웃 API, 회원탈퇴 API, 사용자 차단 API, 차단한 사용자 조회 API, 차단한 사용자 해제 API 개발 완료
    - 이슈 
      =>자동 로그인 API : JWT와 로그아웃 테이블을 통한 인가 과정이 모든 API에 구현되어 있게 된다면 필요성에 대한 의문이 듬.
      =>자동 로그아웃 API : 만료시간이 지난 JWT를 가진 사용자를 로그아웃 테이블을 이용해 자동 로그아웃 처리 
      =>사용자 차단 & 해제 API : 맥스(클라이언트 개발자)와 회의를 하여 차단(+해제)할 사용자의 nickName을 입력값으로 받아 API를 구현하기로 합의 
      =>JWT 인가 적용 : 개발 리더(리야)님께 피드백을 받아 모든 API에 JWT 인가를 적용 예정 
    - API 테스트 완료
      =>로컬에서 API 테스트 완료
      =>prod 서버에서 API 테스트 완료
    - 명세서에 반영 완료
    
    
## 2022-01-14 진행상황    
#### 1. 알림 키워드 등록/삭제/조회 API, 알림 설정한 동네 조회/변경 API 개발 완료 
    - 이슈 
      =>DB의 더미 데이터를 활용하는 과정에서 외래키 제약조건(DELETE CASCADE)의 필요성을 느낌.
      =>알림 키워드 등록 API 결과로 임의의 message만 보내주는거로 변경 예정
      =>알림 키워드 조회 API와 알림 설정한 동네 조회 API가 하나의 화면에 표시되어 있어 맥스(클라이언트 개발자)와 회의를 한 결과 원래 생각했던대로 2개 API로 나누어 구현해도 좋다는 결과를 얻음  
      => 이미지의 경우 현재 URL로 DB에 저장하고 있는데 추후 이미지 파일을 EC2에 저장하고 DB에는 파일명만 저장 예정
    - API 테스트 완료
      =>로컬에서 API 테스트 완료
      =>prod 서버에서 API 테스트 완료
    - 명세서에 반영 완료
        
#### 2. 키워드 알림 상품 조회 API 개발 - 80% 진행
    - 이슈 
      =>상품 테이블, 상품 이미지 테이블, 유저 테이블, 알림 키워드 테이블을 join 하는 과정에서 원하는 결과 값을 얻지 못함
      =>사용자의 동네 정보와 알림 키워드에 해당하는 상품의 정보를 출력하는 과정에서 알림 키워드를 상품 제목과 매칭시켜 최신순으로 출력하는데에 문제가 있음. (LIKE IN 사용 불가..) 
      =>프로필 조회 API : 본인의 프로필만 조회되는 문제를 해결하기 위해 URI를 /users/:idx/profile 에서 /users/:idx/profile?nickName= 로 변경하여 Query String으로 조회할 사용자의 닉네임을 입력 받아 해결 
      
## 2022-01-15 진행상황    
#### 1. 키워드 알림 상품 조회 API, 모아보기 추가 API, 모아보기 취소 API, 모아보기한 사용자 조회 API, 모아보기한 상품 조회 API 개발 완료
    - 이슈     
      =>키워드 알림 상품 조회 API : 상품 관련 거래 상태 관련하여 서버 개발자(예레나)와 논의 결과 saleStatus 칼럼이 0이면 거래완료, 1이면 판매중, 2 나눔중으로 표시하는것으로 ERD를 재설계, 상품 지역 인덱스 칼럼을 상품 지역명으로 변경 / 쿼리문을 작성하는 과정에서 키워드별로 알림 상품을 불러올때 최신순보다 상품순으로 불러와지는 문제에 대해서는 맥스(클라이언트 개발자)와 조율 필요
      =>모아보기한 상품 조회 API : 쿼리 작성시 join문으로 테이블들을 연결하여 원하는 결과를 얻어 오긴 했지만, 아직까지 join문 활용에 적응이 안됨. 
    - API 테스트 완료
      =>로컬에서 API 테스트 완료
      =>prod 서버에서 API 테스트 완료
    - 명세서에 반영 완료

#### 2. 맥스(클라이언트 개발자)가 회원 가입 API, 회원 탈퇴 API 테스트시 이슈 발생 (해결 완료)
    - 회원 가입 API
      =>이슈 : 전화번호 중복 체크 Validation으로 인해 회원 탈퇴후 재가입시 문제 발생
      =>해결 : User 테이블에서 해당 사용자의 status 칼럼이 1일때만 전화번호 중복 체크 Validation이 동작하도록 코드 변경
    - 회원 탈퇴 API
      =>이슈 : 사용자의 동네 정보가 비활성화 되지 않는 문제 발생
      =>해결 : Region 테이블에도 해당 사용자(UserIdx)에 해당하는 status 칼럼을 0으로 변경 시켜 동네 정보 비활성화 적용      
      
      
 ## 2022-01-16 진행상황    
#### 1. 미노출 사용자 추가 api, 사용자 미노출 취소 API, 미노출 사용자 조회 API, 사용자 신고 API, 게시글 신고 API 개발 완료
    - 이슈     
      =>미노출 사용자 추가 api : 미노출 여부를 DB에 등록하면 미노출한 사용자의 중고 거래 글도 더 이상 해당 사용자에게 보여지지 않게 하기 위한 처리 필요... 이 부분에 대해서는 서버 개발자 (예레나)와 논의 필요... 차단한 사용자 API에도 적용 필요!!
      =>사용자 신고 API & 게시글 신고 API : 신고하는 과정에서 미노출 처리도 같이 할 수 있는데, 만약 미노출된 상태에서 신고하게 되면 "이미 미노출된 사용자 입니다"라는 Validation 처리가 동작되지만 사용자 미노출을 적용하게 되면 해당 사용자가 더 이상 보이지 않아 신고를 할 수 없기 떄문에 이 부분은 문제가 될것 같지 않음.
      신고 화면에서 미노출 사용자 처리 체크를 하는 부분을 처리하기 위해 hiddenStatus 변수를 만들어 활성화 되면 값을 1로 전송해 주기로 클라이언트 개발자(맥스)와 협의 완료, 신고 유형에 따라 자동 차단 API 적용 필요 (추후 적용 예정)
    - API 테스트 완료
      =>로컬에서 API 테스트 완료
      =>prod 서버에서 API 테스트 완료
    - 명세서에 반영 완료
    
#### 2.  맥스(클라이언트 개발자)가 프로필 조회 API, 프로필 수정 API 테스트시 이슈 발생 (해결 완료 2건, 미해결 1건)  
    - 프로필 조회 API
      =>이슈 : 닉네임으로 프로필을 조회하는 방식이였는데, 닉네임은 회원가입시 dafult 값(당근 유저 + 전화번호 뒤 4자리)로 설정되기 때문에 중복이 발생하는 경우가 생김
      =>해결 : 닉네임의 default 값을 (당근 유저 + 전화번호 뒤 8자리)로 변경하여 해결 완료, 추가적으로 UserIdx로 프로필 조회를 가능하게 구현 
    - 프로필 수정 API
      =>이슈 : 닉네임의 중복 여부를 체크하는 Validation 처리가 없음, 이미지를 DB에 저장시 URL에 http가 들어갈시 간혹 문제가 발생
      =>해결 : 닉네임 중복 여부를 체크하는 함수 checkNickName() 함수를 추가하여 해결 완료
      =>미해결 : 이미지의 형식에 따라 DB에 저장이 안되는 문제는 추후 추가 테스트 필요, URL이 아닌 이미지 파일명으로 저장 필요. (1월 19일에 해결 완료)
    - 키워드 알림 상품 조회 API  
      =>이슈 : 키워드별로 알림 상품을 불러올때 최신순보다 상품순으로 불러와지는 문제 발생
      =>해결 : 현재 ERD 설계상으로는 키워드 별 배열로 불러올 수 밖에 없기 때문에 키워드 별 상품의 최신순으로 불러오는것으로 협의 완료
      
      
 ## 2022-01-17 진행상황    
#### 1. 2차 피드백 완료  
    - API 명세서 관련 피드백
      =>개발한 API마다 앱 화면 추가 필요
    - API 개발 관련 피드백
      =>모든 API에 트랜잭션 처리 필요
      =>Detail한 Validation 처리 필요
      =>다중 이미지 가져오기는 배열 활용
      =>이미지 활용 : EC2에 이미지 파일을 저장 후 DB에는 이미지 파일의 경로를 저장
      =>3rd party api 과제 : SMS 문자 알림 API 구현
 
#### 2. 동네생활 게시글 작성·조회·수정·삭제 API, 전체·주제별·특정 동네생활 게시글 조회 API 개발 완료
    - 이슈
      =>동네 생활(townActivity) 테이블 실제 앱 화면에 맞게 재설계
      =>URI 재설계 : 앱화면에 맞게 게시글 조회 세분화 (지역별 조회, 주제별 조회, 특정 게시글 조회, 나의 게시글 조회)
      =>게시글에 이미지 여러개를 한번에 등록·조회하는 코드는 추후 추가 예정
    - API 테스트 완료
      =>로컬에서 API 테스트 완료
      =>prod 서버에서 API 테스트 완료
    - 명세서에 반영 완료



 ## 2022-01-18 진행상황    
#### 1. 검색어 등록 API, 최근 검색어 조회·(전체)삭제, 연관 검색어 조회 API, 중고거래 글·동네생활 글·사용자 검색 API 개발 완료
    - 이슈
      =>중고거래 글 검색 API : 검색어가 중고거래 글 제목에 포함되는지 여부를 조건으로 설정하여 구현
      =>동네생활 글 검색 API : 검색어가 동네생활 글 주제에 포함되는지 여부를 조건으로 설정하여 구현
      =>사용자 검색 API      : 검색어가 사용자 닉네임에 포함되는지 여부를 조건으로 설정하여 구현
      =>공통 : 검색 결과 지역을 모든 유저의 메인 지역에만 해당되도록 구현
      =>URI 재설계 : 앱 화면에 맞게 검색어 등록,조회,삭제 등을 세분화
    - API 테스트 완료
      =>로컬에서 API 테스트 완료
      =>prod 서버에서 API 테스트 완료
    - 명세서에 반영 완료
    
    
 ## 2022-01-19 진행상황     
#### 1. SMS 문자 알림 코드 구현 완료
    - coolsms 서비스 사용
      =>API Key와 API Secret 발급 
      =>발신번호 등록
      =>build.gradle에 의존성 추가 : compile group: 'net.nurigo', name: 'javaSDK', version: '2.2'
      =>intellij에 라이브러리(jar) 추가 : javaSDK-2.2.jar, json-simple-1.1.1.jar
    - 회원가입 API와 회원가입 인증 API에 코드 적용 완료
      =>Secret.java에 API Key와 API Secret, 발신번호 저장
      =>UserService.java에서 createUser() 함수와 userJoinCheck() 함수에 구현
      =>일단은 구현한 코드 주석처리 후 마지막 과제 제출일에 실제 적용 예정

#### 2. 동네생활 게시글 등록·수정, 특정 동네생활 게시글 조회 API 업데이트 
    - 이미지 다중 등록·조회·수정 가능하도록 코드 구현 
    - List 클래스 활용

#### 3. 더미데이터 구축
    - DB에 저장할 이미지를 EC2에서 불러와 활용할 수 있도록 서버 구축
    - User 테이블의 사용자 default image를 EC2에 저정한 당근마켓 마스코트 이미지(https://carrot-market.site/image/user/default_image.jpg)로 변경
    - 모든 API를 테스트하며 계속 쌓아나가는 중.

#### 4. 지금까지 구현한 API에 트랜잭션 적용 완료
    - 모든 Service 클래스의 함수에 @Transactional 어노테이션 적용
    
#### 5. BaseResponseStatus.java에서 응답코드 번호 최신화
    - 서버 개발자(예레나)와 응답코드 부여 범위를 나눔
    - 구현한 API에 응답코드 번호 최신화하여 반영
    
    
    
 ## 2022-01-20 진행상황     
#### 1. 더미데이터 구축 완료
    - 모든 API 테스트를 진행하며 클라이언트 개발자(맥스)가 충분히 활용할 수 있도록 더미 데이터 구축
    - 이미지는 EC2 image 폴더에 저장
    
#### 2. API 명세서 최신화
    - 구현한 모든 API에 대한 postman 시연 화면과 앱 화면 첨부
    - 잘못 표기된 부분이 있는지 확인 (ex, 변수 type)

#### 3. API 개발
    - 키워드 알림 상품 API에서 null값인 이미지를 가진 행이 제외되는 문제 해결 (left join문 활용)
    - 동네생활 게시글 관련 API : 공감 수와 댓글 수를 공감 테이블과 댓글 테이블에서 조회하여 가져오도록 쿼리문 변경 + 테이블에서 공감·댓글 칼럼 삭제
    - 모든 API에 대해 Validation 처리와 응답코드 번호 재확인
  
